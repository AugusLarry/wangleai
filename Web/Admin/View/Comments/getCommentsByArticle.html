<extend name="Public:layout"/>
<block name="seo">
	<title>评论列表</title>
	<meta name="keywords" content="">
	<meta name="description" content="">
</block>
<block name="css">
	<link rel="stylesheet" href="__PUBLIC__/plugins/dataTables/css/dataTables.css">
	<link rel="stylesheet" href="__PUBLIC__/css/site.css">
</block>
<block name="content">
	<div class="row">
		<div class="col-md-12">
			<ul class="breadcrumb">
				<li><a href="{:U('Admin/Index/index')}">首页</a></li>
				<li class="active">
					评论管理
				</li>
			</ul>
		</div>
		<div class="col-md-12">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title">
						<a href="{:U('Admin/Comments/index')}">所有评论</a>　/　
						<a href="{:U('/Index/' . $comments[0]['pid'])}" target="_blank" style="font-size:30px;"><php>echo $comments[0]["post_title"]</php></a>下的<php>echo I("get.comment_type") ? "已" : "未"</php>审核评论,共{$comments|count}条
					</h3>
				</div>
				<div class="panel-body">
					<div class="dataTables_wrapper form-inline no-footer">
						<div class="row">
							<div class="col-xs-6">
								<div class="dataTables_length">
									<label>
										<select name="onepagenum" class="form-control input-sm" id="onepagenum">
											<option value="" selected="selected">请选择</option>
											<option value="10">10</option>
											<option value="25">25</option>
											<option value="50">50</option>
											<option value="100">100</option>
										</select>　条每页
									</label>
								</div>
							</div>
							<div class="col-xs-6">
								<div id="example_filter" class="dataTables_filter">
									<label>搜索:　<input type="search" class="form-control input-sm"></label>
								</div>
							</div>
						</div>
						<table class="table table-hover">
							<thead>
							<tr>
								<th width="5%">#</th>
								<th width="25%">作者</th>
								<th width="50%">评论</th>
								<th width="20%">回复至</th>
							</tr>
							</thead>
							<tbody>
							<foreach name="comments" item="v">
								<tr class='titleHover <if condition="$v.comment_type eq 0">danger</if>'>
									<td>{$v.comment_id}</td>
									<td>
										<div class="cl-avatar">
											<if condition="$v.avatar eq ''">
												<img src="/Public/static-index/img/avatar.jpg" alt="">
												<else/>
												<img src="{$v.avatar}" alt="" width="32">
											</if>
										</div>
										<div class="cl-author">
											<span>{$v.comment_author}</span>
											<a href="{$v.comment_author_url}"><span>{$v.comment_author_url}</span></a>
											<a href="mailto:{$v.comment_author_email}"><span>{$v.comment_author_email}</span></a>
											<a href=""><span>{$v.comment_author_ip}</span></a>
										</div>
									</td>
									<td>
										<div class="cl-info">
											提交于<a href="{:U('/Index/' . $v['pid'])}/#comment-{$v.comment_id}" target="_blank">{$v.created_at|date="Y-m-d H:i:s", ###}</a>
											<?php
											if ($v['comment_parent'] != 0) {
												$parent_author = M("Comments")->where(['comment_id' => $v['comment_parent']])->getField("comment_author");
											echo " | 回复给<a href='" . U("/Index/" . $v['pid']) . "/#comment-" . $v['comment_parent'] . "' target='_blank'>" . $parent_author . "</a>";
											}
											?>
										</div>
										<div class="cl-content">{$v.comment_content}</div>
										<div class="cl-handle hidden">
											<if condition="$v.comment_type eq 0">
												<a href="{:U('Admin/Comments/audit', ['id' => $v['comment_id'], 'type' => '1'])}">批准</a>
												<else/>
												<a href="{:U('Admin/Comments/audit', ['id' => $v['comment_id'], 'type' => '0'])}">驳回</a>
											</if>
											<a href="">回复</a>
											<a href="">编辑</a>
											<a href="{:U('Admin/Comments/audit', ['id' => $v['comment_id'], 'type' => '2'])}">垃圾评论</a>
											<a href="{:U('Admin/Comments/audit', ['id' => $v['comment_id'], 'type' => '3'])}">移至回收站</a>
										</div>
									</td>
									<td>
										<div class="cl-response">
											<a href="{:U('Admin/Articles/updateArticle', ['id' => $v['pid']])}" target="_blank">{$v.post_title}</a>
											<a href="{:U('/Index/' . $v['pid'])}" target="_blank">查看文章</a>
											<if condition="$v.comment_count gt 0">
												<a href="{:U('Admin/Comments/getCommentsByArticle', ['comment_post_id' => $v['pid'], 'comment_type' => 1])}" class="inline"><span class="label label-info inbox-notification count" data-toggle="tooltip" data-placement="top" title="" data-original-title="共{$v.comment_count}条已审核评论">{$v.comment_count}</span></a>
												<else/>
												<span class="label label-info inbox-notification count" data-toggle="tooltip" data-placement="top" title="" data-original-title="{$v.comment_count}条评论">{$v.comment_count}</span>
											</if>
											<?php
												$no_audit_comments = M("Comments")->where(['comment_post_id' => $v['pid'], 'comment_type' => 0])->count();
												if ($no_audit_comments > 0) {
													echo "<a href='' class='label label-info inbox-notification count no_audit_comments' data-toggle='tooltip' data-placement='top' title='' data-original-title='共" . $no_audit_comments . "条待审评论'><span>" . $no_audit_comments . "</span></a>";
												}
											?>
										</div>
									</td>
								</tr>
							</foreach>
							</tbody>
						</table>
					</div>
				</div>
				<div class="panel-footer">
					<div class="row">
						<div class="col-xs-12">
							<div class="dataTables_paginate">
								{$show}
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</block>
<block name="js">
	<script src="__PUBLIC__/plugins/icheck/js/icheck.min.js"></script>
	<script>
		$(document).ready(function() {
			$('input').iCheck({
				checkboxClass: 'icheckbox_flat-grey',
				radioClass: 'iradio_flat-grey'
			});
			$('.count').tooltip();
			$("#onepagenum").change(function(){
				var str = window.location.href;
				if (str.indexOf("/onepagenum/") > 0) {
					window.location.href = str.replace(/\/onepagenum\/\d+/g, "") + "/onepagenum/" + $(this).children('option:selected').val();
				} else {
					window.location.href = str + "/onepagenum/" + $(this).children('option:selected').val();
				}
			})
			$(".titleHover").mouseover(function(){
				$(this).find("div.hidden").removeClass("hidden").addClass("show");
				$(this).mouseout(function(){
					$(this).find("div.show").removeClass("show").addClass("hidden");
				})
			})
			$(".repeal, .addtrash, .deleteArticle").click(function(){
				if (!confirm("确定要" + $(this).html() + "吗?")) {
					return false;
				} else {
					return true;
				}
			})
		});
	</script>
</block>