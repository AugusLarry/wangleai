<extend name="Public:layout"/>
<block name="seo">
   <title>文章列表</title>
   <meta name="keywords" content="">
   <meta name="description" content="">
</block>
<block name="css">
   <link rel="stylesheet" href="__PUBLIC__/plugins/dataTables/css/dataTables.css">
</block>
<block name="content">
<div class="row">
   <div class="col-md-12">
      <ul class="breadcrumb">
         <li><a href="{:U('Admin/Index/index')}">首页</a></li>
         <li class="active">
         <?php
            if (strtolower(ACTION_NAME) == 'index') {
               echo "文章列表";
            } else {
               echo "回收站";
            }
         ?>
         </li>
      </ul>
   </div>
   <div class="col-md-12">
      <div class="panel panel-default">
         <div class="panel-heading">
            <h3 class="panel-title">
            <?php
            if (strtolower(ACTION_NAME) == 'index') {
               echo "文章列表　/　<a href='" . U('trash') . "'>回收站</a>";
            } else {
               echo "回收站　/　<a href='" . U('index') . "'>文章列表</a>";
            }
            ?>
            </h3>
            <if condition="strtolower(ACTION_NAME) eq 'index'">
            <div class="actions pull-right">
               <a href="{:U('Admin/Articles/addArticle')}"><i class="fa fa-plus"></i></a>
            </div>
            </if>
         </div>
         <div class="panel-body">
            <div class="dataTables_wrapper form-inline no-footer">
               <div class="row">
                  <div class="col-xs-6">
                     <div class="dataTables_length">
                        <label>
                           <select name="onepagenum" class="form-control input-sm" id="onepagenum">
                              <option value="" selected="selected">请选择</option>
                              <option value="10">10</option>
                              <option value="25">25</option>
                              <option value="50">50</option>
                              <option value="100">100</option>
                           </select>　条每页
                        </label>
                     </div>
                  </div>
                  <div class="col-xs-6">
                     <div id="example_filter" class="dataTables_filter">
                        <label>搜索:　<input type="search" class="form-control input-sm"></label>
                     </div>
                  </div>
               </div>
               <table class="table table-hover">
                  <thead>
                     <tr>
                        <th width="5%">#</th>
                        <th width="42%">标题</th>
                        <th width="12%">作者</th>
                        <th width="12%">分类</th>
                        <th width="15%">标签</th>
                        <th width="4%"><i class="fa fa-comment"></i></th>
                        <th width="10%">日期</th>
                     </tr>
                  </thead>
                  <tbody>
                     <foreach name="posts" item="v">
                        <tr class="titleHover">
                           <td>{$v.id}</td>
                           <td>
                              <a href="{:U('Admin/Articles/updateArticle', ['id' => $v['id']])}">{$v.post_title}</a>
                              <div class="hidden">
                                 <a href="{:U('Admin/Articles/updateArticle', ['id' => $v['id']])}">编辑</a>
                                 <if condition="$v['post_status'] eq 0">
                                    <a href="{:U('Admin/Articles/addtrash', ['id' => $v['id']])}" id="addtrash" class="addtrash">垃圾箱</a>
                                 <elseif condition="$v['post_status'] eq 1" />
                                    <a href="{:U('Admin/Articles/release', ['id' => $v['id']])}" id="release" class="release">发布</a>
                                 <else/>
                                    <a href="{:U('Admin/Articles/repeal', ['id' => $v['id']])}" id="repeal" class="repeal">撤销</a>
                                    <a href="{:U('Admin/Articles/deleteArticle', ['id' => $v['id']])}" id="deleteArticle" class="deleteArticle">删除</a>
                                 </if>
                                 <a href="{:U('Admin/Articles/closeComment', ['id' => $v['id']])}">关闭评论</a>
                              </div>
                           </td>
                           <td>{$v.post_author}</td>
                           <td><a href="{:U('Admin/Articles/getArticlesByTerm', ['term_id' => $v['category'][0]['id']])}">{$v['category'][0]['name']}</a></td>
                           <td>
                              <?php
                              if (!empty($v['tags'])) {
                                 $url = U("Admin/Articles/getArticlesByTerm");
                                 foreach($v['tags'] as $val) {
                                    echo "<a href='" . $url . "/term_id/" . $val['id'] . "'>" . $val['name'] . "</a>、";
                                 }
                              }
                              ?>
                           </td>
                           <td>
                              <if condition="$v.comment_count eq 0">
                              <span class="label label-info inbox-notification count" data-toggle="tooltip" data-placement="top" title="" data-original-title="总共{$v.comment_count}评论">{$v.comment_count}</span>
                              <else/>
                              <a href="{:U('Admin/Comments/getCommentsByArticle', ['comment_post_id' => $v['id'], 'comment_type' => 1])}"><span class="label label-info inbox-notification count" data-toggle="tooltip" data-placement="top" title="" data-original-title="总共{$v.comment_count}评论">{$v.comment_count}</span></a>
                              </if>
                           </td>
                           <td>
                              <p class="text-left" style="margin-bottom: 0;">{$v.created_at|date="Y-m-d", ###}</p>
                              <p class="text-left" style="margin-bottom: 0;">
                                 <if condition="$v['post_status'] eq 0">
                                 已发布
                                 <elseif condition="$v['post_status'] eq 1"/>
                                 草稿
                                 <elseif condition="$v['post_status'] eq 2"/>
                                 垃圾箱
                                 </if>
                              </p>
                           </td>
                        </tr>
                     </foreach>
                  </tbody>
               </table>
            </div>
         </div>
         <div class="panel-footer">
            <div class="row">
               <div class="col-xs-12">
                  <div class="dataTables_paginate">
                     {$show}
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
</div>
</block>
<block name="js">
<script src="__PUBLIC__/plugins/icheck/js/icheck.min.js"></script>
<script>
   $(document).ready(function() {
      $('input').iCheck({
         checkboxClass: 'icheckbox_flat-grey',
         radioClass: 'iradio_flat-grey'
      });
      $('.count').tooltip();
      $("#onepagenum").change(function(){
         var str = window.location.href;
         if (str.indexOf("/onepagenum/") > 0) {
            window.location.href = str.replace(/\/onepagenum\/\d+/g, "") + "/onepagenum/" + $(this).children('option:selected').val();
         } else {
            window.location.href = str + "/onepagenum/" + $(this).children('option:selected').val();
         }
      })
      $(".titleHover").mouseover(function(){
         $(this).find("div.hidden").removeClass("hidden").addClass("show");
         $(this).mouseout(function(){
            $(this).find("div.show").removeClass("show").addClass("hidden");
         })
      })
      $(".repeal, .addtrash, .deleteArticle").click(function(){
         if (!confirm("确定要" + $(this).html() + "吗?")) {
            return false;
         } else {
            return true;
         }
      })
   });
</script>
</block>